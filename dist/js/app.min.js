!function(e){e.app=e.app||{},e.app.Place=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.foursquareId=ko.observable(e.foursquareId),this.marker}}(window),function(e){e.app=e.app||{},e.app.AppViewModel=function(){var a=this;return a.MAP_ERROR_TEMPLATE=$("[data-template=maps-error]").html(),a.places=ko.observableArray([]),a.search=ko.observable(""),"undefined"==typeof e.google?void $("#map-canvas").html(a.MAP_ERROR_TEMPLATE):(a.mapViewModel=new e.app.MapViewModel("map-canvas"),a.init=function(){return $.getJSON("places.json").then(function(n){var o=$.map(n,function(a){return new e.app.Place(a)});a.places(o),a.mapViewModel.initMarkers(a.places)})},a.filteredPlaces=ko.computed(function(){var e=a.search();return ko.utils.arrayFilter(a.places(),function(a){var n=a.name().toLowerCase();return n.indexOf(e)>-1}).sort(function(e,a){return lName=e.name().toLowerCase(),rName=a.name().toLowerCase(),lName==rName?0:lName<rName?-1:1})}),a.filteredPlaces.subscribe(function(e){a.mapViewModel.updateMarkers(e)}),void(a.selectPlaceFromList=function(e){$(".navmenu.canvas-slid").offcanvas("hide"),a.mapViewModel.showPlace(e)}))},$(function(){var a=new e.app.AppViewModel;a.init().then(function(){ko.applyBindings(a)})})}(window),function(e){e.app=e.app||{},e.app.FoursquareViewModel=function(){var e=this;e.PLACE_TEMPLATE=$("[data-template=place-foursquare]").html(),e.API_URL="https://api.foursquare.com/v2/venues/{{venueId}}?client_id=GYEK0PESSPOVGTN1AYR0XFPTHGPVGZDICA1ELEUZQ0M3MUFR&client_secret=JGKE1IPGETB11KPSWTP05HKMY0SF3ZQ4ENPIFD1HYVPY0JVF&v=20130815",e.loadPlaceInfo=function(a){var n=e.API_URL.replace("{{venueId}}",a);return $.getJSON(n).then(function(a){var n={};return n.name=a.response.venue.name||"",n.url=a.response.venue.shortUrl||"",n.rating=a.response.venue.rating||0,n.address=a.response.venue.location.formattedAddress[0]||"",n.city=a.response.venue.location.formattedAddress[1]||"",n.likes=a.response.venue.likes.count||0,n.photo=a.response.venue.bestPhoto.prefix,n.photo+="120x120",n.photo+=a.response.venue.bestPhoto.suffix,n.tips=a.response.venue.tips.groups[0].items[0].text||"",e.processTemplate(n)})},e.processTemplate=function(a){var n=e.PLACE_TEMPLATE;return n=n.replace("{{place.name}}",a.name),n=n.replace("{{place.url}}",a.url),n=n.replace("{{place.rating}}",a.rating),n=n.replace("{{place.address}}",a.address),n=n.replace("{{place.city}}",a.city),n=n.replace("{{place.likes}}",a.likes),n=n.replace("{{place.photo}}",a.photo),n=n.replace("{{place.tips}}",a.tips)}}}(window),function(e){e.app=e.app||{},e.app.MapViewModel=function(a){var n=this;n.PLACE_LOADING_TEMPLATE=$("[data-template=place-loading]").html(),n.PLACE_ERROR_TEMPLATE=$("[data-template=place-error]").html(),n.foursquareViewModel=new e.app.FoursquareViewModel,n.infoWindow=new google.maps.InfoWindow;var o=document.getElementById(a);n.map=new google.maps.Map(o,{zoom:12,center:new google.maps.LatLng(31.755,-106.44)}),n.places=ko.observableArray([]),n.initMarkers=function(e){n.places=e,ko.utils.arrayForEach(e(),function(e){e.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),map:n.map,title:e.name()}),google.maps.event.addListener(e.marker,"click",function(){n.showPlace(e)})})},n.updateMarkers=function(e){ko.utils.arrayForEach(n.places(),function(a){e.indexOf(a)>-1&&!a.marker.map?a.marker.setMap(n.map):-1==e.indexOf(a)&&a.marker.map&&a.marker.setMap(null)})},n.showPlace=function(e){n.infoWindow.setContent(n.PLACE_LOADING_TEMPLATE),n.foursquareViewModel.loadPlaceInfo(e.foursquareId()).then(function(e){n.infoWindow.setContent(e)},function(){n.infoWindow.setContent(n.PLACE_ERROR_TEMPLATE)}),n.infoWindow.open(n.map,e.marker),e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},700)}}}(window);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL1BsYWNlLmpzIiwidmlld01vZGVsL2FwcC12aWV3bW9kZWwuanMiLCJ2aWV3TW9kZWwvZm91cnNxdWFyZS12aWV3bW9kZWwuanMiLCJ2aWV3TW9kZWwvbWFwLXZpZXdtb2RlbC5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJhcHAiLCJQbGFjZSIsImRhdGEiLCJ0aGlzIiwibmFtZSIsImtvIiwib2JzZXJ2YWJsZSIsImxhdCIsImxuZyIsImZvdXJzcXVhcmVJZCIsIm1hcmtlciIsIndpbmRvdyIsIkFwcFZpZXdNb2RlbCIsInNlbGYiLCJNQVBfRVJST1JfVEVNUExBVEUiLCIkIiwiaHRtbCIsInBsYWNlcyIsIm9ic2VydmFibGVBcnJheSIsInNlYXJjaCIsImdvb2dsZSIsIm1hcFZpZXdNb2RlbCIsIk1hcFZpZXdNb2RlbCIsImluaXQiLCJnZXRKU09OIiwidGhlbiIsImpzb24iLCJtYXBwZWRQbGFjZXMiLCJtYXAiLCJpbml0TWFya2VycyIsImZpbHRlcmVkUGxhY2VzIiwiY29tcHV0ZWQiLCJ1dGlscyIsImFycmF5RmlsdGVyIiwicGxhY2UiLCJwbGFjZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJzb3J0IiwibCIsInIiLCJsTmFtZSIsInJOYW1lIiwic3Vic2NyaWJlIiwidXBkYXRlTWFya2VycyIsInNlbGVjdFBsYWNlRnJvbUxpc3QiLCJvZmZjYW52YXMiLCJzaG93UGxhY2UiLCJhcHBseUJpbmRpbmdzIiwiRm91cnNxdWFyZVZpZXdNb2RlbCIsIlBMQUNFX1RFTVBMQVRFIiwiQVBJX1VSTCIsImxvYWRQbGFjZUluZm8iLCJwbGFjZVVybCIsInJlcGxhY2UiLCJyZXNwb25zZSIsInZlbnVlIiwidXJsIiwic2hvcnRVcmwiLCJyYXRpbmciLCJhZGRyZXNzIiwibG9jYXRpb24iLCJmb3JtYXR0ZWRBZGRyZXNzIiwiY2l0eSIsImxpa2VzIiwiY291bnQiLCJwaG90byIsImJlc3RQaG90byIsInByZWZpeCIsInN1ZmZpeCIsInRpcHMiLCJncm91cHMiLCJpdGVtcyIsInRleHQiLCJwcm9jZXNzVGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsIm1hcENhbnZhc0lkIiwiUExBQ0VfTE9BRElOR19URU1QTEFURSIsIlBMQUNFX0VSUk9SX1RFTVBMQVRFIiwiZm91cnNxdWFyZVZpZXdNb2RlbCIsImluZm9XaW5kb3ciLCJtYXBzIiwiSW5mb1dpbmRvdyIsIm1hcENhbnZhc0RvbSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwiTGF0TG5nIiwiYXJyYXlGb3JFYWNoIiwiTWFya2VyIiwicG9zaXRpb24iLCJ0aXRsZSIsImV2ZW50IiwiYWRkTGlzdGVuZXIiLCJzZXRNYXAiLCJzZXRDb250ZW50IiwicGxhY2VJbmZvIiwib3BlbiIsInNldEFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkJPVU5DRSIsInNldFRpbWVvdXQiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEdBQ0FBLEVBQUFDLElBQUFELEVBQUFDLFFBUUFELEVBQUFDLElBQUFDLE1BQUEsU0FBQUMsR0FDQUMsS0FBQUMsS0FBQUMsR0FBQUMsV0FBQUosRUFBQUUsTUFDQUQsS0FBQUksSUFBQUYsR0FBQUMsV0FBQUosRUFBQUssS0FDQUosS0FBQUssSUFBQUgsR0FBQUMsV0FBQUosRUFBQU0sS0FDQUwsS0FBQU0sYUFBQUosR0FBQUMsV0FBQUosRUFBQU8sY0FDQU4sS0FBQU8sU0FHQUMsUUNaQSxTQUFBWixHQUNBQSxFQUFBQyxJQUFBRCxFQUFBQyxRQUVBRCxFQUFBQyxJQUFBWSxhQUFBLFdBQ0EsR0FBQUMsR0FBQVYsSUFxQkEsT0FmQVUsR0FBQUMsbUJBQUFDLEVBQUEsOEJBQUFDLE9BTUFILEVBQUFJLE9BQUFaLEdBQUFhLG9CQU1BTCxFQUFBTSxPQUFBZCxHQUFBQyxXQUFBLElBR0EsbUJBQUFQLEdBQUFxQixXQUNBTCxHQUFBLGVBQUFDLEtBQUFILEVBQUFDLHFCQUdBRCxFQUFBUSxhQUFBLEdBQUF0QixHQUFBQyxJQUFBc0IsYUFBQSxjQU9B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QUF4QixPQUFBc0YsT0FBQSxTQVdBbkYsRUFBQWtDLFVBQUEsU0FBQWIsR0FDQXJCLEVBQUFtRSxXQUFBaUIsV0FBQXBGLEVBQUFnRSx3QkFFQWhFLEVBQUFrRSxvQkFBQTNCLGNBQUFsQixFQUFBekIsZ0JBQ0FnQixLQUFBLFNBQUF5RSxHQUNBckYsRUFBQW1FLFdBQUFpQixXQUFBQyxJQUNBLFdBQ0FyRixFQUFBbUUsV0FBQWlCLFdBQUFwRixFQUFBaUUsd0JBR0FqRSxFQUFBbUUsV0FBQW1CLEtBQUF0RixFQUFBZSxJQUFBTSxFQUFBeEIsUUFFQXdCLEVBQUF4QixPQUFBMEYsYUFBQWhGLE9BQUE2RCxLQUFBb0IsVUFBQUMsUUFDQUMsV0FBQSxXQUNBckUsRUFBQXhCLE9BQUEwRixhQUFBLE9BQ0EsUUFJQXpGIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oZ2xvYmFsKSB7XG4gIGdsb2JhbC5hcHAgPSBnbG9iYWwuYXBwIHx8IHt9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBQbGFjZSBtb2RlbCBjbGFzcyByZXByZXNlbnRpbmcgYW4gaW50ZXJlc3RpbmcgbmVpZ2hib3Job29kIGxvY2F0aW9uLlxuICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSBDb250YWlucyB0aGUgaW5pdGlhbCBwbGFjZSBkYXRhLlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIGdsb2JhbC5hcHAuUGxhY2UgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgdGhpcy5uYW1lID0ga28ub2JzZXJ2YWJsZShkYXRhLm5hbWUpO1xuICAgIHRoaXMubGF0ID0ga28ub2JzZXJ2YWJsZShkYXRhLmxhdCk7XG4gICAgdGhpcy5sbmcgPSBrby5vYnNlcnZhYmxlKGRhdGEubG5nKTtcbiAgICB0aGlzLmZvdXJzcXVhcmVJZCA9IGtvLm9ic2VydmFibGUoZGF0YS5mb3Vyc3F1YXJlSWQpO1xuICAgIHRoaXMubWFya2VyO1xuICB9O1xuXG59KSh3aW5kb3cpO1xuIiwiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGFwcC12aWV3bW9kZWwuanNcbiAqIFRoaXMgZmlsZSBwcm92aWRlcyB0aGUgbWFpbiBhcHAgZW5naW5lIGZvciB0aGUgbmVpZ2hib3Job29kIG1hcC5cbiAqL1xuXG4oZnVuY3Rpb24oZ2xvYmFsKSB7XG4gIGdsb2JhbC5hcHAgPSBnbG9iYWwuYXBwIHx8IHt9O1xuXG4gIGdsb2JhbC5hcHAuQXBwVmlld01vZGVsID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLyoqXG4gICAgICogTWFwIGVycm9yIHRlbXBsYXRlLCBmb3IgZGlzcGxheSB3aGVuIGdvb2dsZSBtYXBzIGZhaWxzIGxvYWRpbmcuXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBzZWxmLk1BUF9FUlJPUl9URU1QTEFURSA9ICQoJ1tkYXRhLXRlbXBsYXRlPW1hcHMtZXJyb3JdJykuaHRtbCgpO1xuXG4gICAgLyoqXG4gICAgICogQXJyYXkgb2YgYWxsIHRoZSBhdmFpbGFibGUgcGxhY2VzLlxuICAgICAqIEB0eXBlIHtBcnJheS48UGxhY2U+fVxuICAgICAqL1xuICAgIHNlbGYucGxhY2VzID0ga28ub2JzZXJ2YWJsZUFycmF5KFtdKTtcblxuICAgIC8qKlxuICAgICAqIFNlYXJjaCB0ZXJtIHRvIGZpbHRlciBwbGFjZXMgYnkgbmFtZS5cbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNlbGYuc2VhcmNoID0ga28ub2JzZXJ2YWJsZSgnJyk7XG5cbiAgICAvKiogQ2hlY2sgaWYgZ29vZ2xlIG1hcHMgbG9hZGVkIGNvcnJlY3RseSBiZWZvcmUgcHJvY2VlZGluZy4gKi9cbiAgICBpZiAodHlwZW9mIGdsb2JhbC5nb29nbGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAkKCcjbWFwLWNhbnZhcycpLmh0bWwoc2VsZi5NQVBfRVJST1JfVEVNUExBVEUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZWxmLm1hcFZpZXdNb2RlbCA9IG5ldyBnbG9iYWwuYXBwLk1hcFZpZXdNb2RlbCgnbWFwLWNhbnZhcycpO1xuXG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGpzb24gZGF0YSAmIG1hcCBpdCB0byBQbGFjZSBtb2RlbCBvYmplY3RzLlxuICAgICAqIEByZXR1cm4ge3Byb21pc2V9IEEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIHdpdGggdGhlIGluaXRpYWwgcGxhY2VzLlxuICAgICAqL1xuICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuICQuZ2V0SlNPTigncGxhY2VzLmpzb24nKS50aGVuKGZ1bmN0aW9uKGpzb24pIHtcbiAgICAgICAgICB2YXIgbWFwcGVkUGxhY2VzID0gJC5tYXAoanNvbiwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBnbG9iYWwuYXBwLlBsYWNlKGRhdGEpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNlbGYucGxhY2VzKG1hcHBlZFBsYWNlcyk7XG4gICAgICAgICAgc2VsZi5tYXBWaWV3TW9kZWwuaW5pdE1hcmtlcnMoc2VsZi5wbGFjZXMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGZpbHRlcmVkIGxpc3Qgb2YgcGxhY2VzIGJ5IHNlYXJjaC5cbiAgICAgKiBAcmV0dXJuIHtBcnJheTxQbGFjZT59IFRoZSBmaWx0ZXJlZCBhcnJheSBvZiBwbGFjZXMgYnkgbmFtZS5cbiAgICAgKi9cbiAgICBzZWxmLmZpbHRlcmVkUGxhY2VzID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VhcmNoID0gc2VsZi5zZWFyY2goKTtcblxuICAgICAgcmV0dXJuIGtvLnV0aWxzLmFycmF5RmlsdGVyKHNlbGYucGxhY2VzKCksIGZ1bmN0aW9uKHBsYWNlKSB7XG5cbiAgICAgICAgICB2YXIgcGxhY2VOYW1lID0gcGxhY2UubmFtZSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgcmV0dXJuIHBsYWNlTmFtZS5pbmRleE9mKHNlYXJjaCkgPiAtMTtcblxuICAgICAgfSkuc29ydChmdW5jdGlvbihsLCByKSB7XG5cbiAgICAgICAgbE5hbWUgPSBsLm5hbWUoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByTmFtZSA9IHIubmFtZSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiBsTmFtZSA9PSByTmFtZSA/IDAgOiAobE5hbWUgPCByTmFtZSA/IC0xIDogMSk7XG5cbiAgICAgIH0pO1xuICAgIH0pO1xuXG5cbiAgICAvKipcbiAgICAgKiBPYnNlcnZlcyBjaGFuZ2VzIG9uIGZpbHRlcmVkIGxpc3QgYW5kIHVwZGF0ZSBtYXAgbWFya2Vycy5cbiAgICAgKiBAcGFyYW0ge0FycmF5PFBsYWNlPn0gZmlsdGVyZWRQbGFjZXMgVGhlIHBsYWNlcyBmaWx0ZXJlZCBieSBuYW1lLlxuICAgICAqL1xuICAgIHNlbGYuZmlsdGVyZWRQbGFjZXMuc3Vic2NyaWJlKGZ1bmN0aW9uKGZpbHRlcmVkUGxhY2VzKSB7XG4gICAgICBzZWxmLm1hcFZpZXdNb2RlbC51cGRhdGVNYXJrZXJzKGZpbHRlcmVkUGxhY2VzKTtcbiAgICB9KTtcblxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIGV2ZW50IG9mIGNsaWNraW5nIG9uIGEgcGxhY2Ugb2YgdGhlIGxpc3QuXG4gICAgICogQHBhcmFtIHtQbGFjZX0gcGxhY2UgVGhlIHNlbGVjdGVkIHBsYWNlIGZyb20gdGhlIGxpc3QuXG4gICAgICovXG4gICAgc2VsZi5zZWxlY3RQbGFjZUZyb21MaXN0ID0gZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgICQoJy5uYXZtZW51LmNhbnZhcy1zbGlkJykub2ZmY2FudmFzKCdoaWRlJyk7XG4gICAgICBzZWxmLm1hcFZpZXdNb2RlbC5zaG93UGxhY2UocGxhY2UpO1xuICAgIH07XG5cbiAgfTtcblxuXG4gIC8qKiBTdGFydHVwIHRoZSBhcHBsaWNhdGlvbi4gKi9cbiAgJChmdW5jdGlvbigpIHtcbiAgICB2YXIgYXBwID0gbmV3IGdsb2JhbC5hcHAuQXBwVmlld01vZGVsKCk7XG4gICAgYXBwLmluaXQoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAga28uYXBwbHlCaW5kaW5ncyhhcHApO1xuICAgIH0pO1xuICB9KTtcblxufSkod2luZG93KTtcbiIsIi8qKlxuICogQGZpbGVvdmVydmlldyBmb3Vyc3F1YXJlLXZpZXdtb2RlbC5qc1xuICogVGhpcyBmaWxlIHByb3ZpZGVzIHRoZSBmb3Vyc3F1YXJlIG1vZHVsZSwgcmV0cmlldmVzIGFkZGl0aW9uYWwgcGxhY2UgaW5mby5cbiAqL1xuXG4gKGZ1bmN0aW9uKGdsb2JhbCkge1xuICBnbG9iYWwuYXBwID0gZ2xvYmFsLmFwcCB8fCB7fTtcblxuICBnbG9iYWwuYXBwLkZvdXJzcXVhcmVWaWV3TW9kZWwgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvKipcbiAgICAgKiBQbGFjZSBGb3Vyc3F1YXJlIHRlbXBsYXRlLCB1c2VkIHRvIGRpc3BsYXkgdGhlIGFkZGl0aW9uYWwgcGxhY2UgaW5mby5cbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNlbGYuUExBQ0VfVEVNUExBVEUgPSAkKCdbZGF0YS10ZW1wbGF0ZT1wbGFjZS1mb3Vyc3F1YXJlXScpLmh0bWwoKTtcblxuICAgIC8qKlxuICAgICAqIEZvdXJzcXVhcmUgYXBpIHVybCwgdXNlZCB0byByZXRyaWV2ZSB0aGUganNvbiBkYXRhIGZvciB0aGUgcGxhY2UuXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBzZWxmLkFQSV9VUkwgPSAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzL3t7dmVudWVJZH19PycgK1xuICAgICAgJ2NsaWVudF9pZD1HWUVLMFBFU1NQT1ZHVE4xQVlSMFhGUFRIR1BWR1pESUNBMUVMRVVaUTBNM01VRlImJyArXG4gICAgICAnY2xpZW50X3NlY3JldD1KR0tFMUlQR0VUQjExS1BTV1RQMDVIS01ZMFNGM1pRNEVOUElGRDFIWVZQWTBKVkYmdj0yMDEzMDgxNSc7XG5cblxuICAgIC8qXG4gICAgICogTG9hZCB0aGUgRm91cnNxdWFyZSBkYXRhIGZvciB0aGUgc2VsZWN0ZWQgcGxhY2UuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGZvdXJzcXVhcmVJZCBUaGUgZm91cnNxdWFyZSB1bmlxdWUgdmVudWUgaWRlbnRpZmllci5cbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFByb2Nlc3NlZCB0ZW1wbGF0ZSB3aXRoIHRoZSBwbGFjZSBpbmZvLlxuICAgICAqL1xuICAgIHNlbGYubG9hZFBsYWNlSW5mbyA9IGZ1bmN0aW9uKGZvdXJzcXVhcmVJZCkge1xuICAgICAgdmFyIHBsYWNlVXJsID0gc2VsZi5BUElfVVJMLnJlcGxhY2UoJ3t7dmVudWVJZH19JywgZm91cnNxdWFyZUlkKTtcblxuICAgICAgcmV0dXJuICQuZ2V0SlNPTihwbGFjZVVybCkudGhlbihmdW5jdGlvbihqc29uKSB7XG4gICAgICAgIHZhciBwbGFjZSA9IHt9O1xuXG4gICAgICAgIHBsYWNlLm5hbWUgPSBqc29uLnJlc3BvbnNlLnZlbnVlLm5hbWUgfHwgJyc7XG4gICAgICAgIHBsYWNlLnVybCA9IGpzb24ucmVzcG9uc2UudmVudWUuc2hvcnRVcmwgfHwgJyc7XG4gICAgICAgIHBsYWNlLnJhdGluZyA9IGpzb24ucmVzcG9uc2UudmVudWUucmF0aW5nIHx8IDA7XG4gICAgICAgIHBsYWNlLmFkZHJlc3MgPSBqc29uLnJlc3BvbnNlLnZlbnVlLmxvY2F0aW9uLmZvcm1hdHRlZEFkZHJlc3NbMF0gfHwgJyc7XG4gICAgICAgIHBsYWNlLmNpdHkgPSBqc29uLnJlc3BvbnNlLnZlbnVlLmxvY2F0aW9uLmZvcm1hdHRlZEFkZHJlc3NbMV0gfHwgJyc7XG4gICAgICAgIHBsYWNlLmxpa2VzID0ganNvbi5yZXNwb25zZS52ZW51ZS5saWtlcy5jb3VudCB8fCAwO1xuICAgICAgICBwbGFjZS5waG90byA9IGpzb24ucmVzcG9uc2UudmVudWUuYmVzdFBob3RvLnByZWZpeDtcbiAgICAgICAgcGxhY2UucGhvdG8gKz0gJzEyMHgxMjAnO1xuICAgICAgICBwbGFjZS5waG90byArPSBqc29uLnJlc3BvbnNlLnZlbnVlLmJlc3RQaG90by5zdWZmaXg7XG4gICAgICAgIHBsYWNlLnRpcHMgPSBqc29uLnJlc3BvbnNlLnZlbnVlLnRpcHMuZ3JvdXBzWzBdLml0ZW1zWzBdLnRleHQgfHwgJyc7XG5cbiAgICAgICAgcmV0dXJuIHNlbGYucHJvY2Vzc1RlbXBsYXRlKHBsYWNlKTtcbiAgICAgIH0pO1xuXG4gICAgfTtcblxuXG4gICAgLypcbiAgICAgKiBQcm9jZXNzIHRoZSBIVE1MIHRlbXBsYXRlIHVzZWQgdG8gZGlzcGxheSB0aGUgcGxhY2UgZGF0YS5cbiAgICAgKiBAcGFyYW0ge1BsYWNlfSBwbGFjZSBUaGUgc2VsZWN0ZWQgcGxhY2UgdG8gc2hvdy5cbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHByb2Nlc3NlZCB0ZW1wbGF0ZSB3aXRoIHRoZSBwbGFjZSBpbmZvLlxuICAgICAqL1xuICAgIHNlbGYucHJvY2Vzc1RlbXBsYXRlID0gZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgIHZhciB0ZW1wbGF0ZSA9IHNlbGYuUExBQ0VfVEVNUExBVEU7XG5cbiAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS5uYW1lfX0nLCBwbGFjZS5uYW1lKTtcbiAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS51cmx9fScsIHBsYWNlLnVybCk7XG4gICAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UucmF0aW5nfX0nLCBwbGFjZS5yYXRpbmcpO1xuICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLmFkZHJlc3N9fScsIHBsYWNlLmFkZHJlc3MpO1xuICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLmNpdHl9fScsIHBsYWNlLmNpdHkpO1xuICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLmxpa2VzfX0nLCBwbGFjZS5saWtlcyk7XG4gICAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UucGhvdG99fScsIHBsYWNlLnBob3RvKTtcbiAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS50aXBzfX0nLCBwbGFjZS50aXBzKTtcblxuICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgIH07XG4gIH07XG5cbn0pKHdpbmRvdyk7XG4iLCIvKipcbiAqIEBmaWxlb3ZlcnZpZXcgbWFwLXZpZXdtb2RlbC5qc1xuICogVGhpcyBmaWxlIHByb3ZpZGVzIHRoZSBnb29nbGUgbWFwcyBtb2R1bGUsIGRpc3BsYXlzIG1hcmtlcnMgYW5kIGluZm9XaW5kb3cuXG4gKi9cblxuIChmdW5jdGlvbihnbG9iYWwpIHtcbiAgZ2xvYmFsLmFwcCA9IGdsb2JhbC5hcHAgfHwge307XG5cbiAgZ2xvYmFsLmFwcC5NYXBWaWV3TW9kZWwgPSBmdW5jdGlvbihtYXBDYW52YXNJZCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8qKlxuICAgICAqIFBsYWNlIGxvYWRpbmcgdGVtcGxhdGUsIHVzZWQgd2hpbGUgdGhlIHBsYWNlIGRhdGEgaXMgbG9hZGluZy5cbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNlbGYuUExBQ0VfTE9BRElOR19URU1QTEFURSA9ICQoJ1tkYXRhLXRlbXBsYXRlPXBsYWNlLWxvYWRpbmddJykuaHRtbCgpO1xuXG4gICAgLyoqXG4gICAgICogUGxhY2UgZXJyb3IgdGVtcGxhdGUsIGZvciBkaXNwbGF5IHdoZW4gdGhlIGZvdXJzcXVhcmUgZGF0YSBmYWlscyBsb2FkaW5nLlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAgc2VsZi5QTEFDRV9FUlJPUl9URU1QTEFURSA9ICQoJ1tkYXRhLXRlbXBsYXRlPXBsYWNlLWVycm9yXScpLmh0bWwoKTtcblxuICAgIC8qKlxuICAgICAqIEZvdXJzcXVhcmUgbW9kdWxlLCB1c2VkIHRvIHJldHJpZXZlIGFkZGl0aW9uYWwgcGxhY2UgaW5mby5cbiAgICAgKiBAdHlwZSB7Rm91cnNxdWFyZVZpZXdNb2RlbH1cbiAgICAgKi9cbiAgICBzZWxmLmZvdXJzcXVhcmVWaWV3TW9kZWwgPSBuZXcgZ2xvYmFsLmFwcC5Gb3Vyc3F1YXJlVmlld01vZGVsKCk7XG5cbiAgICAvKipcbiAgICAgKiBHb29nbGUgTWFwcyBkaWFsb2csIGRpc3BsYXlzIGEgd2luZG93IGFib3ZlIGEgcGxhY2UgbWFya2VyLlxuICAgICAqIEB0eXBlIHtnb29nbGUubWFwcy5JbmZvV2luZG93fVxuICAgICAqL1xuICAgIHNlbGYuaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG5cbiAgICAvKiogVGhlIERPTSBlbGVtZW50IHRvIGF0dGFjaCB0aGUgbWFwIHRvLiAqL1xuICAgIHZhciBtYXBDYW52YXNEb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtYXBDYW52YXNJZCk7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgR29vZ2xlIE1hcCBtYWluIG1vZHVsZS5cbiAgICAgKiBAdHlwZSB7Z29vZ2xlLm1hcHMuTWFwfVxuICAgICAqL1xuICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBDYW52YXNEb20sIHtcbiAgICAgIHpvb206IDEyLFxuICAgICAgY2VudGVyOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDMxLjc1NSwgLTEwNi40NClcbiAgICB9KTtcblxuXG4gICAgLypcbiAgICAgKiBJbml0aWFsaXplIHRoZSBwbGFjZSBtYXJrZXJzIG9uIHRoZSBtYXAuXG4gICAgICogQHBhcmFtIHtBcnJheS48UGxhY2U+fSBwbGFjZXMgVGhlIGluaXRpYWwgbG9hZGVkIHBsYWNlcy5cbiAgICAgKi9cbiAgICBzZWxmLnBsYWNlcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gICAgc2VsZi5pbml0TWFya2VycyA9IGZ1bmN0aW9uKHBsYWNlcykge1xuICAgICAgc2VsZi5wbGFjZXMgPSBwbGFjZXM7XG5cbiAgICAgIGtvLnV0aWxzLmFycmF5Rm9yRWFjaChwbGFjZXMoKSwgZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgICAgcGxhY2UubWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocGxhY2UubGF0KCksIHBsYWNlLmxuZygpKSxcbiAgICAgICAgICBtYXA6IHNlbGYubWFwLFxuICAgICAgICAgIHRpdGxlOiBwbGFjZS5uYW1lKClcbiAgICAgICAgfSk7XG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBsYWNlLm1hcmtlciwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc2VsZi5zaG93UGxhY2UocGxhY2UpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgfTtcblxuXG4gICAgLypcbiAgICAgKiBGaWx0ZXIgdGhlIG1hcCBtYXJrZXJzIHdoZW4gdGhlIHBsYWNlcyBnZXQgZmlsdGVyZWQuXG4gICAgICogQHBhcmFtIHtBcnJheS48UGxhY2U+fSBmaWx0ZXJlZFBsYWNlcyBUaGUgcGxhY2VzIGZpbHRlcmVkIGJ5IG5hbWUuXG4gICAgICovXG4gICAgc2VsZi51cGRhdGVNYXJrZXJzID0gZnVuY3Rpb24oZmlsdGVyZWRQbGFjZXMpIHtcbiAgICAgIGtvLnV0aWxzLmFycmF5Rm9yRWFjaChzZWxmLnBsYWNlcygpLCBmdW5jdGlvbihwbGFjZSkge1xuXG4gICAgICAgIGlmIChmaWx0ZXJlZFBsYWNlcy5pbmRleE9mKHBsYWNlKSA+IC0xICYmICFwbGFjZS5tYXJrZXIubWFwKSB7XG4gICAgICAgICAgcGxhY2UubWFya2VyLnNldE1hcChzZWxmLm1hcCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyZWRQbGFjZXMuaW5kZXhPZihwbGFjZSkgPT0gLTEgJiYgcGxhY2UubWFya2VyLm1hcCkge1xuICAgICAgICAgIHBsYWNlLm1hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgfTtcblxuXG4gICAgLypcbiAgICAgKiBTaG93IGFkZGl0aW9uYWwgaW5mbyBmb3IgdGhlIHNlbGVjdGVkIHBsYWNlLlxuICAgICAqIEBwYXJhbSB7UGxhY2V9IHBsYWNlIFRoZSBzZWxlY3RlZCBwbGFjZSB0byBzaG93LlxuICAgICAqL1xuICAgIHNlbGYuc2hvd1BsYWNlID0gZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgIHNlbGYuaW5mb1dpbmRvdy5zZXRDb250ZW50KHNlbGYuUExBQ0VfTE9BRElOR19URU1QTEFURSk7XG5cbiAgICAgIHNlbGYuZm91cnNxdWFyZVZpZXdNb2RlbC5sb2FkUGxhY2VJbmZvKHBsYWNlLmZvdXJzcXVhcmVJZCgpKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocGxhY2VJbmZvKSB7XG4gICAgICAgIHNlbGYuaW5mb1dpbmRvdy5zZXRDb250ZW50KHBsYWNlSW5mbyk7XG4gICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5pbmZvV2luZG93LnNldENvbnRlbnQoc2VsZi5QTEFDRV9FUlJPUl9URU1QTEFURSk7XG4gICAgICB9KTtcblxuICAgICAgc2VsZi5pbmZvV2luZG93Lm9wZW4oc2VsZi5tYXAsIHBsYWNlLm1hcmtlcik7XG5cbiAgICAgIHBsYWNlLm1hcmtlci5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBwbGFjZS5tYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpO1xuICAgICAgfSwgNzAwKTtcbiAgICB9O1xuICB9O1xuXG59KSh3aW5kb3cpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9