function Place(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.foursquareId=ko.observable(e.foursquareId),this.marker}var AppViewModel=function(){var e=this;return e.mapsErrorTemplate=$("[data-template=maps-error]"),e.places=ko.observableArray([]),e.search=ko.observable(""),"undefined"==typeof google?void $("#map-canvas").html(e.mapsErrorTemplate.html()):(e.mapViewModel=new MapViewModel("map-canvas"),e.init=function(){return $.getJSON("places.json").then(function(a){var r=$.map(a,function(e){return new Place(e)});e.places(r),e.mapViewModel.initMarkers(e.places)})},e.filteredPlaces=ko.computed(function(){var a=e.search();return ko.utils.arrayFilter(e.places(),function(e){var r=e.name().toLowerCase();return r.indexOf(a)>-1}).sort(function(e,a){return lName=e.name().toLowerCase(),rName=a.name().toLowerCase(),lName==rName?0:lName<rName?-1:1})}),e.filteredPlaces.subscribe(function(a){e.mapViewModel.updateMarkers(a)}),void(e.selectPlaceFromList=function(a){$(".navmenu.canvas-slid").offcanvas("hide"),e.mapViewModel.showPlace(a)}))};$(function(){var e=new AppViewModel;e.init().then(function(){ko.applyBindings(e)})});var FoursquareViewModel=function(){var e=this;e.foursquareTemplate=$("[data-template=place-foursquare]"),e.apiUrl="https://api.foursquare.com/v2/venues/{{venueId}}?client_id=GYEK0PESSPOVGTN1AYR0XFPTHGPVGZDICA1ELEUZQ0M3MUFR&client_secret=JGKE1IPGETB11KPSWTP05HKMY0SF3ZQ4ENPIFD1HYVPY0JVF&v=20130815",e.loadPlaceInfo=function(a){var r=e.apiUrl.replace("{{venueId}}",a);return $.getJSON(r).then(function(a){var r={};return r.name=a.response.venue.name||"",r.url=a.response.venue.shortUrl||"",r.rating=a.response.venue.rating||0,r.address=a.response.venue.location.formattedAddress[0]||"",r.city=a.response.venue.location.formattedAddress[1]||"",r.likes=a.response.venue.likes.count||0,r.photo=a.response.venue.bestPhoto.prefix,r.photo+="120x120",r.photo+=a.response.venue.bestPhoto.suffix,r.tips=a.response.venue.tips.groups[0].items[0].text||"",e.processTemplate(r)})},e.processTemplate=function(a){var r=e.foursquareTemplate.html();return r=r.replace("{{place.name}}",a.name),r=r.replace("{{place.url}}",a.url),r=r.replace("{{place.rating}}",a.rating),r=r.replace("{{place.address}}",a.address),r=r.replace("{{place.city}}",a.city),r=r.replace("{{place.likes}}",a.likes),r=r.replace("{{place.photo}}",a.photo),r=r.replace("{{place.tips}}",a.tips)}},MapViewModel=function(e){var a=this;a.placeLoadingTemplate=$("[data-template=place-loading]"),a.placeErrorTemplate=$("[data-template=place-error]"),a.foursquareViewModel=new FoursquareViewModel,a.infoWindow=new google.maps.InfoWindow;var r=document.getElementById(e);a.map=new google.maps.Map(r,{zoom:12,center:new google.maps.LatLng(31.755,-106.44)}),a.places=ko.observableArray([]),a.initMarkers=function(e){a.places=e,ko.utils.arrayForEach(e(),function(e){e.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),map:a.map,title:e.name()}),google.maps.event.addListener(e.marker,"click",function(){a.showPlace(e)})})},a.updateMarkers=function(e){ko.utils.arrayForEach(a.places(),function(r){e.indexOf(r)>-1&&!r.marker.map?r.marker.setMap(a.map):-1==e.indexOf(r)&&r.marker.map&&r.marker.setMap(null)})},a.showPlace=function(e){a.infoWindow.setContent(a.placeLoadingTemplate.html()),a.foursquareViewModel.loadPlaceInfo(e.foursquareId()).then(function(e){a.infoWindow.setContent(e)},function(){a.infoWindow.setContent(a.placeErrorTemplate.html())}),a.infoWindow.open(a.map,e.marker),e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},700)}};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL1BsYWNlLmpzIiwidmlld01vZGVsL0FwcFZpZXdNb2RlbC5qcyIsInZpZXdNb2RlbC9Gb3Vyc3F1YXJlVmlld01vZGVsLmpzIiwidmlld01vZGVsL01hcFZpZXdNb2RlbC5qcyJdLCJuYW1lcyI6WyJQbGFjZSIsImRhdGEiLCJ0aGlzIiwibmFtZSIsImtvIiwib2JzZXJ2YWJsZSIsImxhdCIsImxuZyIsImZvdXJzcXVhcmVJZCIsIm1hcmtlciIsIkFwcFZpZXdNb2RlbCIsInNlbGYiLCJtYXBzRXJyb3JUZW1wbGF0ZSIsIiQiLCJwbGFjZXMiLCJvYnNlcnZhYmxlQXJyYXkiLCJzZWFyY2giLCJnb29nbGUiLCJodG1sIiwibWFwVmlld01vZGVsIiwiTWFwVmlld01vZGVsIiwiaW5pdCIsImdldEpTT04iLCJ0aGVuIiwianNvbiIsIm1hcHBlZFBsYWNlcyIsIm1hcCIsImluaXRNYXJrZXJzIiwiZmlsdGVyZWRQbGFjZXMiLCJjb21wdXRlZCIsInV0aWxzIiwiYXJyYXlGaWx0ZXIiLCJwbGFjZSIsInBsYWNlTmFtZSIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsInNvcnQiLCJsIiwiciIsImxOYW1lIiwick5hbWUiLCJzdWJzY3JpYmUiLCJ1cGRhdGVNYXJrZXJzIiwic2VsZWN0UGxhY2VGcm9tTGlzdCIsIm9mZmNhbnZhcyIsInNob3dQbGFjZSIsImFwcCIsImFwcGx5QmluZGluZ3MiLCJGb3Vyc3F1YXJlVmlld01vZGVsIiwiZm91cnNxdWFyZVRlbXBsYXRlIiwiYXBpVXJsIiwibG9hZFBsYWNlSW5mbyIsInBsYWNlVXJsIiwicmVwbGFjZSIsInJlc3BvbnNlIiwidmVudWUiLCJ1cmwiLCJzaG9ydFVybCIsInJhdGluZyIsImFkZHJlc3MiLCJsb2NhdGlvbiIsImZvcm1hdHRlZEFkZHJlc3MiLCJjaXR5IiwibGlrZXMiLCJjb3VudCIsInBob3RvIiwiYmVzdFBob3RvIiwicHJlZml4Iiwic3VmZml4IiwidGlwcyIsImdyb3VwcyIsIml0ZW1zIiwidGV4dCIsInByb2Nlc3NUZW1wbGF0ZSIsInRlbXBsYXRlIiwibWFwQ2FudmFzSWQiLCJwbGFjZUxvYWRpbmdUZW1wbGF0ZSIsInBsYWNlRXJyb3JUZW1wbGF0ZSIsImZvdXJzcXVhcmVWaWV3TW9kZWwiLCJpbmZvV2luZG93IiwibWFwcyIsIkluZm9XaW5kb3ciLCJtYXBDYW52YXNEb20iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiTWFwIiwiem9vbSIsImNlbnRlciIsIkxhdExuZyIsImFycmF5Rm9yRWFjaCIsIk1hcmtlciIsInBvc2l0aW9uIiwidGl0bGUiLCJldmVudCIsImFkZExpc3RlbmVyIiwic2V0TWFwIiwic2V0Q29udGVudCIsInBsYWNlSW5mbyIsIm9wZW4iLCJzZXRBbmltYXRpb24iLCJBbmltYXRpb24iLCJCT1VOQ0UiLCJzZXRUaW1lb3V0Il0sIm1hcHBpbmdzIjoiQUFHQSxRQUFBQSxPQUFBQyxHQUNBQyxLQUFBQyxLQUFBQyxHQUFBQyxXQUFBSixFQUFBRSxNQUNBRCxLQUFBSSxJQUFBRixHQUFBQyxXQUFBSixFQUFBSyxLQUNBSixLQUFBSyxJQUFBSCxHQUFBQyxXQUFBSixFQUFBTSxLQUNBTCxLQUFBTSxhQUFBSixHQUFBQyxXQUFBSixFQUFBTyxjQUNBTixLQUFBTyxPQ1JBLEdBQUFDLGNBQUEsV0FDQSxHQUFBQyxHQUFBVCxJQVFBLE9BUEFTLEdBQUFDLGtCQUFBQyxFQUFBLDhCQUNBRixFQUFBRyxPQUFBVixHQUFBVyxvQkFDQUosRUFBQUssT0FBQVosR0FBQUMsV0FBQSxJQUtBLG1CQUFBWSxZQUNBSixHQUFBLGVBQUFLLEtBQUFQLEVBQUFDLGtCQUFBTSxTQUdBUCxFQUFBUSxhQUFBLEdBQUFDLGNBQUEsY0FNQVQsRUFBQVUsS0FBQSxXQUNBLE1BQUFSLEdBQUFTLFFBQUEsZUFBQUMsS0FBQSxTQUFBQyxHQUNBLEdBQUFDLEdBQUFaLEVBQUFhLElBQUFGLEVBQUEsU0FBQXZCLEdBQ0EsTUFBQSxJQUFBRCxPQUFBQyxJQUNBVSxHQUFBRyxPQUFBVyxHQUNBZCxF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T0FBQStELEtBQUFvQixVQUFBQyxRQUNBQyxXQUFBLFdBQ0F0RSxFQUFBdkIsT0FBQTBGLGFBQUEsT0FDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQbGFjZSBtb2RlbCBjbGFzcyB0byBzdG9yZSBlYWNoIHBsYWNlIGtleSBkYXRhLlxuICovXG5mdW5jdGlvbiBQbGFjZShkYXRhKSB7XG4gIHRoaXMubmFtZSA9IGtvLm9ic2VydmFibGUoZGF0YS5uYW1lKTtcbiAgdGhpcy5sYXQgPSBrby5vYnNlcnZhYmxlKGRhdGEubGF0KTtcbiAgdGhpcy5sbmcgPSBrby5vYnNlcnZhYmxlKGRhdGEubG5nKTtcbiAgdGhpcy5mb3Vyc3F1YXJlSWQgPSBrby5vYnNlcnZhYmxlKGRhdGEuZm91cnNxdWFyZUlkKTtcbiAgdGhpcy5tYXJrZXI7XG59IiwidmFyIEFwcFZpZXdNb2RlbCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHNlbGYubWFwc0Vycm9yVGVtcGxhdGUgPSAkKCdbZGF0YS10ZW1wbGF0ZT1tYXBzLWVycm9yXScpO1xuICBzZWxmLnBsYWNlcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7XG4gIHNlbGYuc2VhcmNoID0ga28ub2JzZXJ2YWJsZSgnJyk7XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGdvb2dsZSBtYXBzIGxvYWRlZCBjb3JyZWN0bHkgYmVmb3JlIHByb2NlZWRpbmcuXG4gICAqL1xuICBpZiAodHlwZW9mIGdvb2dsZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICQoJyNtYXAtY2FudmFzJykuaHRtbChzZWxmLm1hcHNFcnJvclRlbXBsYXRlLmh0bWwoKSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHNlbGYubWFwVmlld01vZGVsID0gbmV3IE1hcFZpZXdNb2RlbCgnbWFwLWNhbnZhcycpO1xuXG5cbiAgLyoqXG4gICAqIEdldCB0aGUganNvbiBkYXRhICYgbWFwIGl0IHRvIFBsYWNlIG1vZGVsIG9iamVjdHMuXG4gICAqL1xuICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gJC5nZXRKU09OKCdwbGFjZXMuanNvbicpLnRoZW4oZnVuY3Rpb24oanNvbikge1xuICAgICAgICB2YXIgbWFwcGVkUGxhY2VzID0gJC5tYXAoanNvbiwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHJldHVybiBuZXcgUGxhY2UoZGF0YSk7IH0pO1xuICAgICAgICBzZWxmLnBsYWNlcyhtYXBwZWRQbGFjZXMpO1xuICAgICAgICBzZWxmLm1hcFZpZXdNb2RlbC5pbml0TWFya2VycyhzZWxmLnBsYWNlcyk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBmaWx0ZXJlZCBsaXN0LCBieSBzZWFyY2ggbmFtZS5cbiAgICovXG4gIHNlbGYuZmlsdGVyZWRQbGFjZXMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VhcmNoID0gc2VsZi5zZWFyY2goKTtcbiAgICByZXR1cm4ga28udXRpbHMuYXJyYXlGaWx0ZXIoc2VsZi5wbGFjZXMoKSwgZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgICAgdmFyIHBsYWNlTmFtZSA9IHBsYWNlLm5hbWUoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gcGxhY2VOYW1lLmluZGV4T2Yoc2VhcmNoKSA+IC0xO1xuICAgIH0pLnNvcnQoZnVuY3Rpb24obCwgcikgeyBcbiAgICAgIGxOYW1lID0gbC5uYW1lKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJOYW1lID0gci5uYW1lKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiBsTmFtZSA9PSByTmFtZSA/IDAgOiAobE5hbWUgPCByTmFtZSA/IC0xIDogMSkgXG4gICAgfSk7XG4gIH0pO1xuXG4gIHNlbGYuZmlsdGVyZWRQbGFjZXMuc3Vic2NyaWJlKGZ1bmN0aW9uKGZpbHRlcmVkUGxhY2VzKSB7XG4gICAgc2VsZi5tYXBWaWV3TW9kZWwudXBkYXRlTWFya2VycyhmaWx0ZXJlZFBsYWNlcyk7XG4gIH0pO1xuXG4gIHNlbGYuc2VsZWN0UGxhY2VGcm9tTGlzdCA9IGZ1bmN0aW9uKHBsYWNlKSB7XG4gICAgJCgnLm5hdm1lbnUuY2FudmFzLXNsaWQnKS5vZmZjYW52YXMoJ2hpZGUnKTtcbiAgICBzZWxmLm1hcFZpZXdNb2RlbC5zaG93UGxhY2UocGxhY2UpO1xuICB9O1xuICBcbn07XG5cblxuLyoqXG4gKiBJbml0IEFwcC5cbiAqL1xuJChmdW5jdGlvbigpIHtcbiAgdmFyIGFwcCA9IG5ldyBBcHBWaWV3TW9kZWwoKTtcbiAgYXBwLmluaXQoKS50aGVuKGZ1bmN0aW9uKCkgeyBcbiAgICBrby5hcHBseUJpbmRpbmdzKGFwcCk7XG4gIH0pO1xufSk7IiwidmFyIEZvdXJzcXVhcmVWaWV3TW9kZWwgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBzZWxmLmZvdXJzcXVhcmVUZW1wbGF0ZSA9ICQoJ1tkYXRhLXRlbXBsYXRlPXBsYWNlLWZvdXJzcXVhcmVdJyk7XG4gIHNlbGYuYXBpVXJsID0gJ2h0dHBzOi8vYXBpLmZvdXJzcXVhcmUuY29tL3YyL3ZlbnVlcy97e3ZlbnVlSWR9fT8nICtcbiAgICAnY2xpZW50X2lkPUdZRUswUEVTU1BPVkdUTjFBWVIwWEZQVEhHUFZHWkRJQ0ExRUxFVVpRME0zTVVGUiYnICsgXG4gICAgJ2NsaWVudF9zZWNyZXQ9SkdLRTFJUEdFVEIxMUtQU1dUUDA1SEtNWTBTRjNaUTRFTlBJRkQxSFlWUFkwSlZGJnY9MjAxMzA4MTUnO1xuXG5cbiAgLypcbiAgICogTG9hZCBhZGRpdGlvbmFsIEZvdXJzcXVhcmUgZGF0YSBmb3IgdGhlIHNlbGVjdGVkIHBsYWNlLlxuICAgKi9cbiAgc2VsZi5sb2FkUGxhY2VJbmZvID0gZnVuY3Rpb24oZm91cnNxdWFyZUlkKSB7XG4gICAgdmFyIHBsYWNlVXJsID0gc2VsZi5hcGlVcmwucmVwbGFjZSgne3t2ZW51ZUlkfX0nLCBmb3Vyc3F1YXJlSWQpO1xuICAgIHJldHVybiAkLmdldEpTT04ocGxhY2VVcmwpLnRoZW4oZnVuY3Rpb24oanNvbikge1xuICAgICAgdmFyIHBsYWNlID0ge307XG4gICAgICBwbGFjZS5uYW1lID0ganNvbi5yZXNwb25zZS52ZW51ZS5uYW1lIHx8ICcnO1xuICAgICAgcGxhY2UudXJsID0ganNvbi5yZXNwb25zZS52ZW51ZS5zaG9ydFVybCB8fCAnJztcbiAgICAgIHBsYWNlLnJhdGluZyA9IGpzb24ucmVzcG9uc2UudmVudWUucmF0aW5nIHx8IDA7XG4gICAgICBwbGFjZS5hZGRyZXNzID0ganNvbi5yZXNwb25zZS52ZW51ZS5sb2NhdGlvbi5mb3JtYXR0ZWRBZGRyZXNzWzBdIHx8ICcnO1xuICAgICAgcGxhY2UuY2l0eSA9IGpzb24ucmVzcG9uc2UudmVudWUubG9jYXRpb24uZm9ybWF0dGVkQWRkcmVzc1sxXSB8fCAnJztcbiAgICAgIHBsYWNlLmxpa2VzID0ganNvbi5yZXNwb25zZS52ZW51ZS5saWtlcy5jb3VudCB8fCAwO1xuICAgICAgcGxhY2UucGhvdG8gPSBqc29uLnJlc3BvbnNlLnZlbnVlLmJlc3RQaG90by5wcmVmaXg7XG4gICAgICBwbGFjZS5waG90byArPSAnMTIweDEyMCc7XG4gICAgICBwbGFjZS5waG90byArPSBqc29uLnJlc3BvbnNlLnZlbnVlLmJlc3RQaG90by5zdWZmaXg7XG4gICAgICBwbGFjZS50aXBzID0ganNvbi5yZXNwb25zZS52ZW51ZS50aXBzLmdyb3Vwc1swXS5pdGVtc1swXS50ZXh0IHx8ICcnO1xuICAgICAgcmV0dXJuIHNlbGYucHJvY2Vzc1RlbXBsYXRlKHBsYWNlKTtcbiAgICB9KTtcbiAgfTtcblxuXG4gIC8qXG4gICAqIFByb2Nlc3MgdGhlIGh0bWwgdGVtcGxhdGUgdG8gZGlzcGxheSBwbGFjZSBkYXRhLlxuICAgKi9cbiAgc2VsZi5wcm9jZXNzVGVtcGxhdGUgPSBmdW5jdGlvbihwbGFjZSkge1xuICAgIHZhciB0ZW1wbGF0ZSA9IHNlbGYuZm91cnNxdWFyZVRlbXBsYXRlLmh0bWwoKTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UubmFtZX19JywgcGxhY2UubmFtZSk7XG4gICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLnVybH19JywgcGxhY2UudXJsKTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UucmF0aW5nfX0nLCBwbGFjZS5yYXRpbmcpO1xuICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS5hZGRyZXNzfX0nLCBwbGFjZS5hZGRyZXNzKTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UuY2l0eX19JywgcGxhY2UuY2l0eSk7XG4gICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLmxpa2VzfX0nLCBwbGFjZS5saWtlcyk7XG4gICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLnBob3RvfX0nLCBwbGFjZS5waG90byk7XG4gICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLnRpcHN9fScsIHBsYWNlLnRpcHMpO1xuICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgfTtcbn07IiwidmFyIE1hcFZpZXdNb2RlbCA9IGZ1bmN0aW9uKG1hcENhbnZhc0lkKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgc2VsZi5wbGFjZUxvYWRpbmdUZW1wbGF0ZSA9ICQoJ1tkYXRhLXRlbXBsYXRlPXBsYWNlLWxvYWRpbmddJyk7XG4gIHNlbGYucGxhY2VFcnJvclRlbXBsYXRlID0gJCgnW2RhdGEtdGVtcGxhdGU9cGxhY2UtZXJyb3JdJyk7XG4gIHNlbGYuZm91cnNxdWFyZVZpZXdNb2RlbCA9IG5ldyBGb3Vyc3F1YXJlVmlld01vZGVsKCk7XG4gIHNlbGYuaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG4gIHZhciBtYXBDYW52YXNEb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtYXBDYW52YXNJZCk7XG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBDYW52YXNEb20sIHtcbiAgICB6b29tOiAxMixcbiAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoMzEuNzU1LCAtMTA2LjQ0KVxuICB9KTtcblxuICBcbiAgLypcbiAgICogSW5pdGlhbGl6ZSB0aGUgcGxhY2UgbWFya2VycyBvbiB0aGUgbWFwLlxuICAgKi9cbiAgc2VsZi5wbGFjZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoW10pO1xuICBzZWxmLmluaXRNYXJrZXJzID0gZnVuY3Rpb24ocGxhY2VzKSB7XG4gICAgc2VsZi5wbGFjZXMgPSBwbGFjZXM7XG4gICAga28udXRpbHMuYXJyYXlGb3JFYWNoKHBsYWNlcygpLCBmdW5jdGlvbihwbGFjZSkge1xuICAgICAgcGxhY2UubWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocGxhY2UubGF0KCksIHBsYWNlLmxuZygpKSxcbiAgICAgICAgICBtYXA6IHNlbGYubWFwLFxuICAgICAgICAgIHRpdGxlOiBwbGFjZS5uYW1lKClcbiAgICAgIH0pO1xuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocGxhY2UubWFya2VyLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5zaG93UGxhY2UocGxhY2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cblxuICAvKlxuICAgKiBGaWx0ZXIgdGhlIG1hcCBtYXJrZXJzIHdoZW4gdGhlIHBsYWNlcyBnZXQgZmlsdGVyZWQuXG4gICAqL1xuICBzZWxmLnVwZGF0ZU1hcmtlcnMgPSBmdW5jdGlvbihmaWx0ZXJlZFBsYWNlcykge1xuICAgIGtvLnV0aWxzLmFycmF5Rm9yRWFjaChzZWxmLnBsYWNlcygpLCBmdW5jdGlvbihwbGFjZSkge1xuICAgICAgaWYoZmlsdGVyZWRQbGFjZXMuaW5kZXhPZihwbGFjZSkgPiAtMSAmJiAhcGxhY2UubWFya2VyLm1hcCkge1xuICAgICAgICBwbGFjZS5tYXJrZXIuc2V0TWFwKHNlbGYubWFwKTtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyZWRQbGFjZXMuaW5kZXhPZihwbGFjZSkgPT0gLTEgJiYgcGxhY2UubWFya2VyLm1hcCkge1xuICAgICAgICBwbGFjZS5tYXJrZXIuc2V0TWFwKG51bGwpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG5cbiAgLypcbiAgICogU2hvdyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZvciB0aGUgc2VsZWN0ZWQgcGxhY2UuXG4gICAqL1xuICBzZWxmLnNob3dQbGFjZSA9IGZ1bmN0aW9uKHBsYWNlKSB7XG4gICAgc2VsZi5pbmZvV2luZG93LnNldENvbnRlbnQoc2VsZi5wbGFjZUxvYWRpbmdUZW1wbGF0ZS5odG1sKCkpO1xuICAgIHNlbGYuZm91cnNxdWFyZVZpZXdNb2RlbC5sb2FkUGxhY2VJbmZvKHBsYWNlLmZvdXJzcXVhcmVJZCgpKVxuICAgIC50aGVuKGZ1bmN0aW9uKHBsYWNlSW5mbykge1xuICAgICAgc2VsZi5pbmZvV2luZG93LnNldENvbnRlbnQocGxhY2VJbmZvKTtcbiAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuaW5mb1dpbmRvdy5zZXRDb250ZW50KHNlbGYucGxhY2VFcnJvclRlbXBsYXRlLmh0bWwoKSk7XG4gICAgfSk7XG4gICAgc2VsZi5pbmZvV2luZG93Lm9wZW4oc2VsZi5tYXAsIHBsYWNlLm1hcmtlcik7XG4gICAgcGxhY2UubWFya2VyLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgcGxhY2UubWFya2VyLnNldEFuaW1hdGlvbihudWxsKTtcbiAgICB9LCA3MDApO1xuICB9O1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=