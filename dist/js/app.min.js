function Place(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.foursquareId=ko.observable(e.foursquareId),this.marker}var AppViewModel=function(){var e=this;e.places=ko.observableArray([]),e.search=ko.observable(""),e.mapViewModel=new MapViewModel("map-canvas"),e.init=function(){return $.getJSON("places.json").then(function(a){var n=$.map(a,function(e){return new Place(e)});e.places(n),e.mapViewModel.initMarkers(e.places)})},e.filteredPlaces=ko.computed(function(){var a=e.search();return ko.utils.arrayFilter(e.places(),function(e){var n=e.name().toLowerCase();return n.indexOf(a)>-1}).sort(function(e,a){return lName=e.name().toLowerCase(),rName=a.name().toLowerCase(),lName==rName?0:lName<rName?-1:1})}),e.filteredPlaces.subscribe(function(a){e.mapViewModel.updateMarkers(a)}),e.selectPlaceFromList=function(a){$(".navmenu.canvas-slid").offcanvas("hide"),e.mapViewModel.showPlace(a)}};$(function(){var e=new AppViewModel;e.init().then(function(){ko.applyBindings(e)})});var FoursquareViewModel=function(){var e=this;e.foursquareTemplate=$("[data-template=place-foursquare]"),e.apiUrl="https://api.foursquare.com/v2/venues/{{venueId}}?client_id=GYEK0PESSPOVGTN1AYR0XFPTHGPVGZDICA1ELEUZQ0M3MUFR&client_secret=JGKE1IPGETB11KPSWTP05HKMY0SF3ZQ4ENPIFD1HYVPY0JVF&v=20130815",e.loadPlaceInfo=function(a){var n=e.apiUrl.replace("{{venueId}}",a);return $.getJSON(n).then(function(a){var n={};return n.name=a.response.venue.name||"",n.url=a.response.venue.shortUrl||"",n.rating=a.response.venue.rating||0,n.address=a.response.venue.location.formattedAddress[0]||"",n.city=a.response.venue.location.formattedAddress[1]||"",n.likes=a.response.venue.likes.count||0,n.photo=a.response.venue.bestPhoto.prefix,n.photo+="120x120",n.photo+=a.response.venue.bestPhoto.suffix,n.tips=a.response.venue.tips.groups[0].items[0].text||"",e.processTemplate(n)})},e.processTemplate=function(a){var n=e.foursquareTemplate.html();return n=n.replace("{{place.name}}",a.name),n=n.replace("{{place.url}}",a.url),n=n.replace("{{place.rating}}",a.rating),n=n.replace("{{place.address}}",a.address),n=n.replace("{{place.city}}",a.city),n=n.replace("{{place.likes}}",a.likes),n=n.replace("{{place.photo}}",a.photo),n=n.replace("{{place.tips}}",a.tips)}},MapViewModel=function(e){var a=this;a.loadingTemplate=$("[data-template=place-loading]"),a.foursquareViewModel=new FoursquareViewModel,a.infoWindow=new google.maps.InfoWindow;var n=document.getElementById(e);a.map=new google.maps.Map(n,{zoom:12,center:new google.maps.LatLng(31.755,-106.44)}),a.places=ko.observableArray([]),a.initMarkers=function(e){a.places=e,ko.utils.arrayForEach(e(),function(e){e.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),map:a.map,title:e.name()}),google.maps.event.addListener(e.marker,"click",function(){a.showPlace(e)})})},a.updateMarkers=function(e){ko.utils.arrayForEach(a.places(),function(n){e.indexOf(n)>-1&&!n.marker.map?n.marker.setMap(a.map):-1==e.indexOf(n)&&n.marker.map&&n.marker.setMap(null)})},a.showPlace=function(e){a.infoWindow.setContent(a.loadingTemplate.html()),a.foursquareViewModel.loadPlaceInfo(e.foursquareId()).then(function(e){a.infoWindow.setContent(e)}),a.infoWindow.open(a.map,e.marker),e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},700)}};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL1BsYWNlLmpzIiwidmlld01vZGVsL0FwcFZpZXdNb2RlbC5qcyIsInZpZXdNb2RlbC9Gb3Vyc3F1YXJlVmlld01vZGVsLmpzIiwidmlld01vZGVsL01hcFZpZXdNb2RlbC5qcyJdLCJuYW1lcyI6WyJQbGFjZSIsImRhdGEiLCJ0aGlzIiwibmFtZSIsImtvIiwib2JzZXJ2YWJsZSIsImxhdCIsImxuZyIsImZvdXJzcXVhcmVJZCIsIm1hcmtlciIsIkFwcFZpZXdNb2RlbCIsInNlbGYiLCJwbGFjZXMiLCJvYnNlcnZhYmxlQXJyYXkiLCJzZWFyY2giLCJtYXBWaWV3TW9kZWwiLCJNYXBWaWV3TW9kZWwiLCJpbml0IiwiJCIsImdldEpTT04iLCJ0aGVuIiwianNvbiIsIm1hcHBlZFBsYWNlcyIsIm1hcCIsImluaXRNYXJrZXJzIiwiZmlsdGVyZWRQbGFjZXMiLCJjb21wdXRlZCIsInV0aWxzIiwiYXJyYXlGaWx0ZXIiLCJwbGFjZSIsInBsYWNlTmFtZSIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsInNvcnQiLCJsIiwiciIsImxOYW1lIiwick5hbWUiLCJzdWJzY3JpYmUiLCJ1cGRhdGVNYXJrZXJzIiwic2VsZWN0UGxhY2VGcm9tTGlzdCIsIm9mZmNhbnZhcyIsInNob3dQbGFjZSIsImFwcCIsImFwcGx5QmluZGluZ3MiLCJGb3Vyc3F1YXJlVmlld01vZGVsIiwiZm91cnNxdWFyZVRlbXBsYXRlIiwiYXBpVXJsIiwibG9hZFBsYWNlSW5mbyIsInBsYWNlVXJsIiwicmVwbGFjZSIsInJlc3BvbnNlIiwidmVudWUiLCJ1cmwiLCJzaG9ydFVybCIsInJhdGluZyIsImFkZHJlc3MiLCJsb2NhdGlvbiIsImZvcm1hdHRlZEFkZHJlc3MiLCJjaXR5IiwibGlrZXMiLCJjb3VudCIsInBob3RvIiwiYmVzdFBob3RvIiwicHJlZml4Iiwic3VmZml4IiwidGlwcyIsImdyb3VwcyIsIml0ZW1zIiwidGV4dCIsInByb2Nlc3NUZW1wbGF0ZSIsInRlbXBsYXRlIiwiaHRtbCIsIm1hcENhbnZhc0lkIiwibG9hZGluZ1RlbXBsYXRlIiwiZm91cnNxdWFyZVZpZXdNb2RlbCIsImluZm9XaW5kb3ciLCJnb29nbGUiLCJtYXBzIiwiSW5mb1dpbmRvdyIsIm1hcENhbnZhc0RvbSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwiTGF0TG5nIiwiYXJyYXlGb3JFYWNoIiwiTWFya2VyIiwicG9zaXRpb24iLCJ0aXRsZSIsImV2ZW50IiwiYWRkTGlzdGVuZXIiLCJzZXRNYXAiLCJzZXRDb250ZW50IiwicGxhY2VJbmZvIiwib3BlbiIsInNldEFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkJPVU5DRSIsInNldFRpbWVvdXQiXSwibWFwcGluZ3MiOiJBQUdBLFFBQUFBLE9BQUFDLEdBQ0FDLEtBQUFDLEtBQUFDLEdBQUFDLFdBQUFKLEVBQUFFLE1BQ0FELEtBQUFJLElBQUFGLEdBQUFDLFdBQUFKLEVBQUFLLEtBQ0FKLEtBQUFLLElBQUFILEdBQUFDLFdBQUFKLEVBQUFNLEtBQ0FMLEtBQUFNLGFBQUFKLEdBQUFDLFdBQUFKLEVBQUFPLGNBQ0FOLEtBQUFPLE9DUkEsR0FBQUMsY0FBQSxXQUNBLEdBQUFDLEdBQUFULElBQ0FTLEdBQUFDLE9BQUFSLEdBQUFTLG9CQUNBRixFQUFBRyxPQUFBVixHQUFBQyxXQUFBLElBQ0FNLEVBQUFJLGFBQUEsR0FBQUMsY0FBQSxjQU1BTCxFQUFBTSxLQUFBLFdBQ0EsTUFBQUMsR0FBQUMsUUFBQSxlQUFBQyxLQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQUosRUFBQUssSUFBQUYsRUFBQSxTQUFBcEIsR0FDQSxNQUFBLElBQUFELE9BQUFDLElBQ0FVLEdBQUFDLE9BQUFVLEdBQ0FYLEVBQUFJLGFBQUFTLFlBQUFiLEVBQUFDLFdBT0FELEVBQUFjLGVBQUFyQixHQUFBc0IsU0FBQSxXQUNBLEdBQUFaLEdBQUFILEVBQUFHLFFBQ0EsT0FBQVYsSUFBQXVCLE1BQUFDLFlBQUFqQixFQUFBQyxTQUFBLFNBQUFp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LE9BQUFBLEVBQ0FSLEdBQUF1QixNQUFBNEQsYUFBQTNFLElBQUEsU0FBQWlCLEdBQ0FBLEVBQUFwQixPQUFBLEdBQUFvRSxRQUFBQyxLQUFBVSxRQUNBQyxTQUFBLEdBQUFaLFFBQUFDLEtBQUFRLE9BQUF6RCxFQUFBdkIsTUFBQXVCLEVBQUF0QixPQUNBZ0IsSUFBQVosRUFBQVksSUFDQW1FLE1BQUE3RCxFQUFBMUIsU0FFQTBFLE9BQUFDLEtBQUFhLE1BQUFDLFlBQUEvRCxFQUFBcEIsT0FBQSxRQUFBLFdBQ0FFLEVBQUErQixVQUFBYixRQVNBbEIsRUFBQTRCLGNBQUEsU0FBQWQsR0FDQXJCLEdBQUF1QixNQUFBNEQsYUFBQTVFLEVBQUFDLFNBQUEsU0FBQWlCLEdBQ0FKLEVBQUFPLFFBQUFILEdBQUEsS0FBQUEsRUFBQXBCLE9BQUFjLElBQ0FNLEVBQUFwQixPQUFBb0YsT0FBQWxGLEVBQUFZLEtBQ0EsSUFBQUUsRUFBQU8sUUFBQUgsSUFBQUEsRUFBQXBCLE9BQUFjLEtBQ0FNLEVBQUFwQixPQUFBb0YsT0FBQSxTQVNBbEYsRUFBQStCLFVBQUEsU0FBQWIsR0FDQWxCLEVBQUFpRSxXQUFBa0IsV0FBQW5GLEVBQUErRCxnQkFBQUYsUUFDQTdELEVBQUFnRSxvQkFBQTNCLGNBQUFuQixFQUFBckIsZ0JBQ0FZLEtBQUEsU0FBQTJFLEdBQ0FwRixFQUFBaUUsV0FBQWtCLFdBQUFDLEtBRUFwRixFQUFBaUUsV0FBQW9CLEtBQUFyRixFQUFBWSxJQUFBTSxFQUFBcEIsUUFDQW9CLEVBQUFwQixPQUFBd0YsYUFBQXBCLE9BQUFDLEtBQUFvQixVQUFBQyxRQUNBQyxXQUFBLFdBQ0F2RSxFQUFBcEIsT0FBQXdGLGFBQUEsT0FDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQbGFjZSBtb2RlbCBjbGFzcyB0byBzdG9yZSBlYWNoIHBsYWNlIGtleSBkYXRhLlxuICovXG5mdW5jdGlvbiBQbGFjZShkYXRhKSB7XG4gIHRoaXMubmFtZSA9IGtvLm9ic2VydmFibGUoZGF0YS5uYW1lKTtcbiAgdGhpcy5sYXQgPSBrby5vYnNlcnZhYmxlKGRhdGEubGF0KTtcbiAgdGhpcy5sbmcgPSBrby5vYnNlcnZhYmxlKGRhdGEubG5nKTtcbiAgdGhpcy5mb3Vyc3F1YXJlSWQgPSBrby5vYnNlcnZhYmxlKGRhdGEuZm91cnNxdWFyZUlkKTtcbiAgdGhpcy5tYXJrZXI7XG59IiwidmFyIEFwcFZpZXdNb2RlbCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHNlbGYucGxhY2VzID0ga28ub2JzZXJ2YWJsZUFycmF5KFtdKTtcbiAgc2VsZi5zZWFyY2ggPSBrby5vYnNlcnZhYmxlKCcnKTtcbiAgc2VsZi5tYXBWaWV3TW9kZWwgPSBuZXcgTWFwVmlld01vZGVsKCdtYXAtY2FudmFzJyk7XG5cblxuICAvKipcbiAgICogR2V0IHRoZSBqc29uIGRhdGEgJiBtYXAgaXQgdG8gUGxhY2UgbW9kZWwgb2JqZWN0cy5cbiAgICovXG4gIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkLmdldEpTT04oJ3BsYWNlcy5qc29uJykudGhlbihmdW5jdGlvbihqc29uKSB7XG4gICAgICAgIHZhciBtYXBwZWRQbGFjZXMgPSAkLm1hcChqc29uLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQbGFjZShkYXRhKTsgfSk7XG4gICAgICAgIHNlbGYucGxhY2VzKG1hcHBlZFBsYWNlcyk7XG4gICAgICAgIHNlbGYubWFwVmlld01vZGVsLmluaXRNYXJrZXJzKHNlbGYucGxhY2VzKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhIGZpbHRlcmVkIGxpc3QsIGJ5IHNlYXJjaCBuYW1lLlxuICAgKi9cbiAgc2VsZi5maWx0ZXJlZFBsYWNlcyA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWFyY2ggPSBzZWxmLnNlYXJjaCgpO1xuICAgIHJldHVybiBrby51dGlscy5hcnJheUZpbHRlcihzZWxmLnBsYWNlcygpLCBmdW5jdGlvbihwbGFjZSkge1xuICAgICAgICB2YXIgcGxhY2VOYW1lID0gcGxhY2UubmFtZSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiBwbGFjZU5hbWUuaW5kZXhPZihzZWFyY2gpID4gLTE7XG4gICAgfSkuc29ydChmdW5jdGlvbihsLCByKSB7IFxuICAgICAgbE5hbWUgPSBsLm5hbWUoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgck5hbWUgPSByLm5hbWUoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIGxOYW1lID09IHJOYW1lID8gMCA6IChsTmFtZSA8IHJOYW1lID8gLTEgOiAxKSBcbiAgICB9KTtcbiAgfSk7XG5cbiAgc2VsZi5maWx0ZXJlZFBsYWNlcy5zdWJzY3JpYmUoZnVuY3Rpb24oZmlsdGVyZWRQbGFjZXMpIHtcbiAgICBzZWxmLm1hcFZpZXdNb2RlbC51cGRhdGVNYXJrZXJzKGZpbHRlcmVkUGxhY2VzKTtcbiAgfSk7XG5cbiAgc2VsZi5zZWxlY3RQbGFjZUZyb21MaXN0ID0gZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAkKCcubmF2bWVudS5jYW52YXMtc2xpZCcpLm9mZmNhbnZhcygnaGlkZScpO1xuICAgIHNlbGYubWFwVmlld01vZGVsLnNob3dQbGFjZShwbGFjZSk7XG4gIH07XG4gIFxufTtcblxuXG4vKipcbiAqIEluaXQgQXBwLlxuICovXG4kKGZ1bmN0aW9uKCkge1xuICB2YXIgYXBwID0gbmV3IEFwcFZpZXdNb2RlbCgpO1xuICBhcHAuaW5pdCgpLnRoZW4oZnVuY3Rpb24oKSB7IFxuICAgIGtvLmFwcGx5QmluZGluZ3MoYXBwKTtcbiAgfSk7XG59KTsiLCJ2YXIgRm91cnNxdWFyZVZpZXdNb2RlbCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHNlbGYuZm91cnNxdWFyZVRlbXBsYXRlID0gJCgnW2RhdGEtdGVtcGxhdGU9cGxhY2UtZm91cnNxdWFyZV0nKTtcbiAgc2VsZi5hcGlVcmwgPSAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzL3t7dmVudWVJZH19PycgK1xuICAgICdjbGllbnRfaWQ9R1lFSzBQRVNTUE9WR1ROMUFZUjBYRlBUSEdQVkdaRElDQTFFTEVVWlEwTTNNVUZSJicgKyBcbiAgICAnY2xpZW50X3NlY3JldD1KR0tFMUlQR0VUQjExS1BTV1RQMDVIS01ZMFNGM1pRNEVOUElGRDFIWVZQWTBKVkYmdj0yMDEzMDgxNSc7XG5cblxuICAvKlxuICAgKiBMb2FkIGFkZGl0aW9uYWwgRm91cnNxdWFyZSBkYXRhIGZvciB0aGUgc2VsZWN0ZWQgcGxhY2UuXG4gICAqL1xuICBzZWxmLmxvYWRQbGFjZUluZm8gPSBmdW5jdGlvbihmb3Vyc3F1YXJlSWQpIHtcbiAgICB2YXIgcGxhY2VVcmwgPSBzZWxmLmFwaVVybC5yZXBsYWNlKCd7e3ZlbnVlSWR9fScsIGZvdXJzcXVhcmVJZCk7XG4gICAgcmV0dXJuICQuZ2V0SlNPTihwbGFjZVVybCkudGhlbihmdW5jdGlvbihqc29uKSB7XG4gICAgICB2YXIgcGxhY2UgPSB7fTtcbiAgICAgIHBsYWNlLm5hbWUgPSBqc29uLnJlc3BvbnNlLnZlbnVlLm5hbWUgfHwgJyc7XG4gICAgICBwbGFjZS51cmwgPSBqc29uLnJlc3BvbnNlLnZlbnVlLnNob3J0VXJsIHx8ICcnO1xuICAgICAgcGxhY2UucmF0aW5nID0ganNvbi5yZXNwb25zZS52ZW51ZS5yYXRpbmcgfHwgMDtcbiAgICAgIHBsYWNlLmFkZHJlc3MgPSBqc29uLnJlc3BvbnNlLnZlbnVlLmxvY2F0aW9uLmZvcm1hdHRlZEFkZHJlc3NbMF0gfHwgJyc7XG4gICAgICBwbGFjZS5jaXR5ID0ganNvbi5yZXNwb25zZS52ZW51ZS5sb2NhdGlvbi5mb3JtYXR0ZWRBZGRyZXNzWzFdIHx8ICcnO1xuICAgICAgcGxhY2UubGlrZXMgPSBqc29uLnJlc3BvbnNlLnZlbnVlLmxpa2VzLmNvdW50IHx8IDA7XG4gICAgICBwbGFjZS5waG90byA9IGpzb24ucmVzcG9uc2UudmVudWUuYmVzdFBob3RvLnByZWZpeDtcbiAgICAgIHBsYWNlLnBob3RvICs9ICcxMjB4MTIwJztcbiAgICAgIHBsYWNlLnBob3RvICs9IGpzb24ucmVzcG9uc2UudmVudWUuYmVzdFBob3RvLnN1ZmZpeDtcbiAgICAgIHBsYWNlLnRpcHMgPSBqc29uLnJlc3BvbnNlLnZlbnVlLnRpcHMuZ3JvdXBzWzBdLml0ZW1zWzBdLnRleHQgfHwgJyc7XG4gICAgICByZXR1cm4gc2VsZi5wcm9jZXNzVGVtcGxhdGUocGxhY2UpO1xuICAgIH0pO1xuICB9O1xuXG5cbiAgLypcbiAgICogUHJvY2VzcyB0aGUgaHRtbCB0ZW1wbGF0ZSB0byBkaXNwbGF5IHBsYWNlIGRhdGEuXG4gICAqL1xuICBzZWxmLnByb2Nlc3NUZW1wbGF0ZSA9IGZ1bmN0aW9uKHBsYWNlKSB7XG4gICAgdmFyIHRlbXBsYXRlID0gc2VsZi5mb3Vyc3F1YXJlVGVtcGxhdGUuaHRtbCgpO1xuICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS5uYW1lfX0nLCBwbGFjZS5uYW1lKTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UudXJsfX0nLCBwbGFjZS51cmwpO1xuICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS5yYXRpbmd9fScsIHBsYWNlLnJhdGluZyk7XG4gICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKCd7e3BsYWNlLmFkZHJlc3N9fScsIHBsYWNlLmFkZHJlc3MpO1xuICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgne3twbGFjZS5jaXR5fX0nLCBwbGFjZS5jaXR5KTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UubGlrZXN9fScsIHBsYWNlLmxpa2VzKTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UucGhvdG99fScsIHBsYWNlLnBob3RvKTtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoJ3t7cGxhY2UudGlwc319JywgcGxhY2UudGlwcyk7XG4gICAgcmV0dXJuIHRlbXBsYXRlO1xuICB9O1xufTsiLCJ2YXIgTWFwVmlld01vZGVsID0gZnVuY3Rpb24obWFwQ2FudmFzSWQpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBzZWxmLmxvYWRpbmdUZW1wbGF0ZSA9ICQoJ1tkYXRhLXRlbXBsYXRlPXBsYWNlLWxvYWRpbmddJyk7XG4gIHNlbGYuZm91cnNxdWFyZVZpZXdNb2RlbCA9IG5ldyBGb3Vyc3F1YXJlVmlld01vZGVsKCk7XG4gIHNlbGYuaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG4gIHZhciBtYXBDYW52YXNEb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtYXBDYW52YXNJZCk7XG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBDYW52YXNEb20sIHtcbiAgICB6b29tOiAxMixcbiAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoMzEuNzU1LCAtMTA2LjQ0KVxuICB9KTtcblxuICBcbiAgLypcbiAgICogSW5pdGlhbGl6ZSB0aGUgcGxhY2UgbWFya2VycyBvbiB0aGUgbWFwLlxuICAgKi9cbiAgc2VsZi5wbGFjZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoW10pO1xuICBzZWxmLmluaXRNYXJrZXJzID0gZnVuY3Rpb24ocGxhY2VzKSB7XG4gICAgc2VsZi5wbGFjZXMgPSBwbGFjZXM7XG4gICAga28udXRpbHMuYXJyYXlGb3JFYWNoKHBsYWNlcygpLCBmdW5jdGlvbihwbGFjZSkge1xuICAgICAgcGxhY2UubWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocGxhY2UubGF0KCksIHBsYWNlLmxuZygpKSxcbiAgICAgICAgICBtYXA6IHNlbGYubWFwLFxuICAgICAgICAgIHRpdGxlOiBwbGFjZS5uYW1lKClcbiAgICAgIH0pO1xuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocGxhY2UubWFya2VyLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5zaG93UGxhY2UocGxhY2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cblxuICAvKlxuICAgKiBGaWx0ZXIgdGhlIG1hcCBtYXJrZXJzIHdoZW4gdGhlIHBsYWNlcyBnZXQgZmlsdGVyZWQuXG4gICAqL1xuICBzZWxmLnVwZGF0ZU1hcmtlcnMgPSBmdW5jdGlvbihmaWx0ZXJlZFBsYWNlcykge1xuICAgIGtvLnV0aWxzLmFycmF5Rm9yRWFjaChzZWxmLnBsYWNlcygpLCBmdW5jdGlvbihwbGFjZSkge1xuICAgICAgaWYoZmlsdGVyZWRQbGFjZXMuaW5kZXhPZihwbGFjZSkgPiAtMSAmJiAhcGxhY2UubWFya2VyLm1hcCkge1xuICAgICAgICBwbGFjZS5tYXJrZXIuc2V0TWFwKHNlbGYubWFwKTtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyZWRQbGFjZXMuaW5kZXhPZihwbGFjZSkgPT0gLTEgJiYgcGxhY2UubWFya2VyLm1hcCkge1xuICAgICAgICBwbGFjZS5tYXJrZXIuc2V0TWFwKG51bGwpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG5cbiAgLypcbiAgICogU2hvdyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZvciB0aGUgc2VsZWN0ZWQgcGxhY2UuXG4gICAqL1xuICBzZWxmLnNob3dQbGFjZSA9IGZ1bmN0aW9uKHBsYWNlKSB7XG4gICAgc2VsZi5pbmZvV2luZG93LnNldENvbnRlbnQoc2VsZi5sb2FkaW5nVGVtcGxhdGUuaHRtbCgpKTtcbiAgICBzZWxmLmZvdXJzcXVhcmVWaWV3TW9kZWwubG9hZFBsYWNlSW5mbyhwbGFjZS5mb3Vyc3F1YXJlSWQoKSlcbiAgICAudGhlbihmdW5jdGlvbihwbGFjZUluZm8pIHtcbiAgICAgIHNlbGYuaW5mb1dpbmRvdy5zZXRDb250ZW50KHBsYWNlSW5mbyk7XG4gICAgfSk7XG4gICAgc2VsZi5pbmZvV2luZG93Lm9wZW4oc2VsZi5tYXAsIHBsYWNlLm1hcmtlcik7XG4gICAgcGxhY2UubWFya2VyLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgcGxhY2UubWFya2VyLnNldEFuaW1hdGlvbihudWxsKTtcbiAgICB9LCA3MDApO1xuICB9O1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=