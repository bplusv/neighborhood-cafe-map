!function(e){e.app=e.app||{},e.app.Place=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.foursquareId=ko.observable(e.foursquareId),this.marker}}(window),function(e){e.app=e.app||{},e.app.AppViewModel=function(){var a=this;return a.MAP_ERROR_TEMPLATE=$("[data-template=maps-error]").html(),a.places=ko.observableArray([]),a.search=ko.observable(""),"undefined"==typeof e.google?void $("#map-canvas").html(a.MAP_ERROR_TEMPLATE):(a.mapViewModel=new e.app.MapViewModel("map-canvas"),a.init=function(){return $.getJSON("places.json").then(function(n){var o=$.map(n,function(a){return new e.app.Place(a)});a.places(o),a.mapViewModel.initMarkers(a.places)})},a.filteredPlaces=ko.computed(function(){var e=a.search().toLowerCase();return ko.utils.arrayFilter(a.places(),function(a){var n=a.name().toLowerCase();return n.indexOf(e)>-1}).sort(function(e,a){return lName=e.name().toLowerCase(),rName=a.name().toLowerCase(),lName==rName?0:lName<rName?-1:1})}),a.filteredPlaces.subscribe(function(e){a.mapViewModel.updateMarkers(e)}),void(a.selectPlaceFromList=function(e){$(".navmenu.canvas-slid").offcanvas("hide"),a.mapViewModel.showPlace(e)}))},$(function(){var a=new e.app.AppViewModel;a.init().then(function(){ko.applyBindings(a)})})}(window),function(e){e.app=e.app||{},e.app.FoursquareViewModel=function(){var e=this;e.PLACE_TEMPLATE=$("[data-template=place-foursquare]").html(),e.API_URL="https://api.foursquare.com/v2/venues/{{venueId}}?client_id=GYEK0PESSPOVGTN1AYR0XFPTHGPVGZDICA1ELEUZQ0M3MUFR&client_secret=JGKE1IPGETB11KPSWTP05HKMY0SF3ZQ4ENPIFD1HYVPY0JVF&v=20130815",e.loadPlaceInfo=function(a){var n=e.API_URL.replace("{{venueId}}",a);return $.getJSON(n).then(function(a){var n={};return n.name=a.response.venue.name||"",n.url=a.response.venue.shortUrl||"",n.rating=a.response.venue.rating||0,n.address=a.response.venue.location.formattedAddress[0]||"",n.city=a.response.venue.location.formattedAddress[1]||"",n.likes=a.response.venue.likes.count||0,n.photo=a.response.venue.bestPhoto.prefix,n.photo+="120x120",n.photo+=a.response.venue.bestPhoto.suffix,n.tips=a.response.venue.tips.groups[0].items[0].text||"",e.processTemplate(n)})},e.processTemplate=function(a){var n=e.PLACE_TEMPLATE;return n=n.replace("{{place.name}}",a.name),n=n.replace("{{place.url}}",a.url),n=n.replace("{{place.rating}}",a.rating),n=n.replace("{{place.address}}",a.address),n=n.replace("{{place.city}}",a.city),n=n.replace("{{place.likes}}",a.likes),n=n.replace("{{place.photo}}",a.photo),n=n.replace("{{place.tips}}",a.tips)}}}(window),function(e){e.app=e.app||{},e.app.MapViewModel=function(a){var n=this;n.PLACE_LOADING_TEMPLATE=$("[data-template=place-loading]").html(),n.PLACE_ERROR_TEMPLATE=$("[data-template=place-error]").html(),n.foursquareViewModel=new e.app.FoursquareViewModel,n.infoWindow=new google.maps.InfoWindow;var o=document.getElementById(a);n.map=new google.maps.Map(o,{zoom:12,center:new google.maps.LatLng(31.755,-106.44)}),n.places=ko.observableArray([]),n.initMarkers=function(e){n.places=e,ko.utils.arrayForEach(e(),function(e){e.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),map:n.map,title:e.name()}),google.maps.event.addListener(e.marker,"click",function(){n.showPlace(e)})})},n.updateMarkers=function(e){ko.utils.arrayForEach(n.places(),function(a){e.indexOf(a)>-1&&!a.marker.map?a.marker.setMap(n.map):-1==e.indexOf(a)&&a.marker.map&&a.marker.setMap(null)})},n.showPlace=function(e){n.infoWindow.setContent(n.PLACE_LOADING_TEMPLATE),n.foursquareViewModel.loadPlaceInfo(e.foursquareId()).then(function(e){n.infoWindow.setContent(e)},function(){n.infoWindow.setContent(n.PLACE_ERROR_TEMPLATE)}),n.infoWindow.open(n.map,e.marker),e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},700)}}}(window);